{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% load cars_extras %}

{% block title %}{{ car.title }} - {{ site_settings.site_name }}{% endblock %}

{% block content %}
<div class="container my-5">
  <div class="row">
    <div class="col-md-8">
      <div class="card mb-4">
        {% if car.images.first %}
          <img src="{{ car.images.first.image.url }}" class="card-img-top" alt="{{ car.title }}" style="height: 400px; object-fit: cover;">
        {% else %}
          <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 400px;">
            <i class="fas fa-car fa-5x text-muted"></i>
          </div>
        {% endif %}

        {% if car.images.all|length > 1 %}
        <div class="card-body">
          <div class="row">
            {% for image in car.images.all %}
              {% if not image.is_primary %}
              <div class="col-3 mb-2">
                <img src="{{ image.image.url }}" class="img-fluid rounded" alt="{{ car.title }}" style="height: 80px; object-fit: cover; width: 100%;">
              </div>
              {% endif %}
            {% endfor %}
          </div>
        </div>
        {% endif %}
      </div>

      <div class="card">
        <div class="card-body">
          <h1 class="card-title">{{ car.title }}</h1>
          <div class="row mb-4">
            <div class="col-md-6"><h4 class="text-success">{{ car.price|floatformat:0 }} تومان</h4></div>
            <div class="col-md-6 text-start">
              <span class="badge bg-primary">{{ car.status|title }}</span>
              {% if car.is_featured %}<span class="badge bg-warning">ویژه</span>{% endif %}
            </div>
          </div>

          <div class="row mb-4">
            <div class="col-md-3"><strong>برند:</strong><br>{{ car.brand.name }}</div>
            <div class="col-md-3"><strong>سال:</strong><br>{{ car.year }}</div>
            <div class="col-md-3"><strong>کارکرد:</strong><br>{{ car.mileage|floatformat:0 }} کیلومتر</div>
            <div class="col-md-3"><strong>سوخت:</strong><br>{{ car.fuel_type|title }}</div>
          </div>

          <div class="row mb-4">
            <div class="col-md-3"><strong>گیربکس:</strong><br>{{ car.transmission|title }}</div>
            <div class="col-md-3"><strong>حجم موتور:</strong><br>{{ car.engine_size }} لیتر</div>
            <div class="col-md-3"><strong>رنگ:</strong><br>{{ car.color }}</div>
            <div class="col-md-3"><strong>دسته‌بندی:</strong><br>{{ car.category.name }}</div>
          </div>

          <h5>توضیحات</h5>
          <p>{{ car.description }}</p>

          {% if car.features %}
            <h5>امکانات</h5>
            <div class="mb-3">
              {% for feature in car.features|split:"," %}
                <span class="feature-badge">{{ feature }}</span>
              {% endfor %}
            </div>
          {% endif %}
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card mb-4">
        <div class="card-header"><h5><i class="fas fa-envelope"></i> ارسال استعلام</h5></div>
        <div class="card-body">{% crispy form %}</div>
      </div>

      <div class="card">
        <div class="card-header"><h5><i class="fas fa-phone"></i> تماس با ما</h5></div>
        <div class="card-body">
          <p><i class="fas fa-phone"></i> {{ site_settings.contact_phone }}</p>
          <p><i class="fas fa-envelope"></i> {{ site_settings.contact_email }}</p>
          <p><i class="fas fa-map-marker-alt"></i> {{ site_settings.contact_address }}</p>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
